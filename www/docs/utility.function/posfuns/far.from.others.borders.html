<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
	<meta http-equiv="Content-Type" content="text/html;
	charset=UTF-8" />
	<link href="http://directlabels.r-forge.r-project.org/estilo1.css"
	rel="stylesheet" type="text/css" />
	<title>directlabels documentation - far.from.others.borders</title>
  </head>

<body>

<h1><a href="../../index.html">directlabels</a> - utility.function -
Positioning Method - far.from.others.borders</h1>

<p>Find the point on each curve which maximizes the distance to the
plot border or to another curve.</p>

<pre>
far.from.others.borders &lt;- function(all.groups,...,debug=FALSE){
  group.data &lt;- split(all.groups, all.groups$group)
  group.list &lt;- list()
  for(groups in names(group.data)){
    ## Run linear interpolation to get a set of points on which we
    ## could place the label (this is useful for e.g. the lasso path
    ## where there are only a few points plotted).
    approx.list &lt;- with(group.data[[groups]], approx(x, y))
    if(debug){
      with(approx.list, grid.points(x, y, default.units="cm"))
    }
    group.list[[groups]] &lt;- data.frame(approx.list, groups)
  }
  output &lt;- data.frame()
  for(group.i in seq_along(group.list)){
    one.group &lt;- group.list[[group.i]]
    ## From Mark Schmidt: "For the location of the boxes, I found the
    ## data point on the line that has the maximum distance (in the
    ## image coordinates) to the nearest data point on another line or
    ## to the image boundary."
    dist.mat &lt;- matrix(NA, length(one.group$x), 3)
    colnames(dist.mat) &lt;- c("x","y","other")
    ## dist.mat has 3 columns: the first two are the shortest distance
    ## to the nearest x and y border, and the third is the shortest
    ## distance to another data point.
    for(xy in c("x", "y")){
      xy.vec &lt;- one.group[,xy]
      xy.mat &lt;- rbind(xy.vec, xy.vec)
      lim.fun &lt;- get(sprintf("%slimits", xy))
      diff.mat &lt;- xy.mat - lim.fun()
      dist.mat[,xy] &lt;- apply(abs(diff.mat), 2, min)
    }
    other.groups &lt;- group.list[-group.i]
    other.df &lt;- do.call(rbind, other.groups)
    for(row.i in 1:nrow(dist.mat)){
      r &lt;- one.group[row.i,]
      other.dist &lt;- with(other.df, (x-r$x)^2 + (y-r$y)^2)
      dist.mat[row.i,"other"] &lt;- sqrt(min(other.dist))
    }
    shortest.dist &lt;- apply(dist.mat, 1, min)
    picked &lt;- <a href="../../utility.function/posfuns/calc.boxes.html">calc.boxes</a>(one.group[which.max(shortest.dist),])
    ## Mark's label rotation: "For the angle, I computed the slope
    ## between neighboring data points (which isn't ideal for noisy
    ## data, it should probably be based on a smoothed estimate)."
    left &lt;- max(picked$left, min(one.group$x))
    right &lt;- min(picked$right, max(one.group$x))
    neighbors &lt;- approx(one.group$x, one.group$y, c(left, right))
    slope &lt;- with(neighbors, (y[2]-y[1])/(x[2]-x[1]))
    picked$rot &lt;- 180*atan(slope)/pi
    output &lt;- rbind(output, picked)
  }
  output
}
</pre>



<center>
<table>
<tr><td>Please
contact <a href="http://sugiyama-www.cs.titech.ac.jp/~toby/">Toby
Dylan Hocking</a> if you are
using <a href="http://directlabels.r-forge.r-project.org/">directlabels</a>
or have ideas to contribute, thanks!</td>
</tr>
<tr><td align="center">Documentation website generated from source
code version 2014.1.27
(svn revision 675)
using <a href="http://inlinedocs.r-forge.r-project.org">inlinedocs</a>.</td>
</tr>
<tr>
<td align="center">
    <a href="http://validator.w3.org/check?uri=referer">validate</a>
</td>
</tr>
</table>

</center>

</body>

</html>
