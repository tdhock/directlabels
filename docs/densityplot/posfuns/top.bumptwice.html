<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
	<meta http-equiv="Content-Type" content="text/html;
	charset=UTF-8" />
	<link href="http://directlabels.r-forge.r-project.org/estilo1.css"
	rel="stylesheet" type="text/css" />
	<title>directlabels documentation - top.bumptwice</title>
  </head>

<body>

<h1><a href="../../index.html">directlabels</a> - densityplot -
Positioning Method - top.bumptwice</h1>

<p>Label the tops, bump labels up to avoid other labels, then to the
side to avoid collisions with points.</p>

<pre>
top.bumptwice &lt;- function(d,debug=FALSE,...){
  labtab &lt;- <a href="../../utility.function/posfuns/apply.method.html">apply.method</a>("<a href="../../densityplot/posfuns/top.bumpup.html">top.bumpup</a>",d)
  if(debug)<a href="../../utility.function/posfuns/draw.rects.html">draw.rects</a>(labtab)
  <a href="../../utility.function/posfuns/gapply.html">gapply</a>(labtab,function(l,...){
    between &lt;- d[d$y&gt;l$bottom &amp; d$y&lt;l$top,]
    x &lt;- sort(c(range(d$x),between$x))
    if(length(x)==2)return(l)
    dif &lt;- diff(x)
    ok &lt;- dif&gt;with(l,right-left)
    if(!any(ok))ok[1] &lt;- TRUE
    i &lt;- which(ok)
    intervals &lt;- data.frame(left=x[i]+l$w/2,right=x[i+1]-l$w/2,i=seq_along(i))
    molt &lt;- with(intervals,data.frame(i,x=c(left,right)))
    dists &lt;- transform(molt,dist=x-l$x)
    best &lt;- dists[which.min(abs(dists$dist)),]
    besti &lt;- intervals[best$i,]
    l$x &lt;- if(l$x&lt;besti$right &amp; l$x&gt;besti$left)l$x else best$x
    l
  })
}
</pre>

<table>
<tr>
  <td><img alt="chemscore" src="../../densityplot/chemscore.top.bumptwice.png" /></td>
  <td><p><a href="../plots/chemscore.html">chemscore</a></p><pre>
data(Chem97,package="mlmRev")
library(lattice)
p &lt;- densityplot(~gcsescore|gender,Chem97,
            groups=factor(score),layout=c(1,2),
            n=500,plot.points=FALSE)
direct.label(p,"top.bumptwice")
  </pre></td>
</tr>
<tr>
  <td><img alt="iris" src="../../densityplot/iris.top.bumptwice.png" /></td>
  <td><p><a href="../plots/iris.html">iris</a></p><pre>
library(reshape2)
iris2 &lt;- melt(iris,id="Species")
library(lattice)
p &lt;- densityplot(~value|variable,iris2,groups=Species,scales="free")
direct.label(p,"top.bumptwice")
  </pre></td>
</tr>
<tr>
  <td><img alt="loci" src="../../densityplot/loci.top.bumptwice.png" /></td>
  <td><p><a href="../plots/loci.html">loci</a></p><pre>
loci &lt;- data.frame(ppp=c(rbeta(800,10,10),rbeta(100,0.15,1),rbeta(100,1,0.15)),
                   type=factor(c(rep("NEU",800),rep("POS",100),rep("BAL",100))))
library(ggplot2)
p &lt;- qplot(ppp,data=loci,colour=type,geom="density")
direct.label(p,"top.bumptwice")
  </pre></td>
</tr>
</table>

<center>
<table>
<tr><td>Please
contact <a href="http://sugiyama-www.cs.titech.ac.jp/~toby/">Toby
Dylan Hocking</a> if you are
using <a href="http://directlabels.r-forge.r-project.org/">directlabels</a>
or have ideas to contribute, thanks!</td>
</tr>
<tr><td align="center">Documentation website generated from source
code version 2014.1.27
(svn revision 675)
using <a href="http://inlinedocs.r-forge.r-project.org">inlinedocs</a>.</td>
</tr>
<tr>
<td align="center">
    <a href="http://validator.w3.org/check?uri=referer">validate</a>
</td>
</tr>
</table>

</center>

</body>

</html>
